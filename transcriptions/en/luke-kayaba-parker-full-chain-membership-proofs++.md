# Luke 'Kayaba' Parker

_**Full-chain Membership Proofs++**_

_This talk will go over the newly discussed Full Chain Membership Proofs++ protocol, evolving Full Chain Membership Proofs into an upgrade independent of Seraphis and its associated migration._

[https://youtu.be/7tw5VJNynfw](https://youtu.be/7tw5VJNynfw)

---

_**Luke:**_ Hello everyone, I'm back again from last year and happy to be talking today about Full-chain Membership Proofs++.

I always like to start out my slides with a bit of an introduction. Luke Parker, also known as Kayaba or kayabaNerve online if you're more used to IRC. I'm the developer of Full-chain Membership Proofs++ and also Serai, a decentralized exchange for Monero. I'm a member of the MAGIC Monero Fund Committee. So if you want to donate to Monero development and you are in the US and you want to get a US tax deduction, MAGIC is a 501(c)(3) charity you can donate to - so really great thing there. I am also lucky enough to be a three-time speaker at MoneroKon - we'll see how high that gets up to this week. In just as a little fun fact - I'm really great at naming things and I will not accept any contest on that matter.

So Full-chain Membership Proofs. It was a proposed upgrade for Monero which would replace rings, and with that it would remove basically all of the issues with rings. This have been discussed over the years, I'm not sure how aware each and every one of you are with them, but it's roughly referred to as the EAE attack within the Monero ecosystem. There's also the EABE attack which just adds an extra letter, only half joking. It's in the Zcash community, it's also known as the "overseer attack", and then it's also generally referred to as "tainted dust". But basically all of it boils down to, if I send your address, you know, 10 different instances of one Monero, and then you spend, you make a 10 input transaction in every single one of those rings, for every single input with 16 ring members, every single one has an output I flagged, I can say: yes, you're almost certainly consolidating the instances of one Monero I spammed you with. And that's a horribly egregious case. You're consolidating not only 10 inputs, but you're also consolidating, you know, you have 10 inputs in the first place. You practically don't need it to be that extreme, and even with just two outputs, this can be very devastating. There's also other considerations even within the single output or single input case.

So, Full-chain Membership Proofs themselves. It's kind of been a goal of the Monero project for several years now. Zcash solved it by using zk-SNARKs. Specifically, they used the Pinocchio proving system, and then they moved to Sapling. Both of those required a trusted setup. They finally moved to Orchard as their payment protocol and with that they're using Halo2 for their proving system and that finally removed the trusted setup on their end. And what I really wanted to emphasize there is, we've been trying to do this for years, but if we weren't willing to accept a trusted setup, we had very few options, and we had to put in a lot of effort on our end to make something that doesn't have a trusted setup, but is still actually performant and viable.

So what we ended up using is Bulletproofs, which was already used by Monero as a range proof. And it's kind of ridiculous, because It came out seven years ago and here we are proposing it for use again today. So really just says something about the quality of Bulletproofs. And last year at MoneroKon, when I announced this work on Full-chain Membership Proofs, it was going to be done with Seraphis. So this talk itself is going to be over what's happened in the last year since.

So now we've moved from Full-chain Membership Proofs to Full-chain Membership Proofs++ - trademark pending. And that's short for Full-chain Membership Proofs plus spend authorization, plus linkability. I told you I was really great at naming things here. So this is a replacement not for the membership proofs that we're doing with Seraphis, or that was proposed to be done with Seraphis, but this is a replacement for the CLSAG ring signature we currently have in Monero. So instead of replacing the component of Seraphis in the future, it's replacing part of Monero today, and it's being done without the Seraphis upgrade. When I initially proposed this, it was just exactly that. Full-chain Membership Proofs today on Monero without the Seraphis upgrade. So we're not bottlenecked by the Seraphis upgrade, but it's actually become its own feature complete proposal with Seraphis. So everything that you may have been looking forward to with Seraphis, which has a variety of features, which I go over a bit later, it could now be done with this proposal. And the biggest thing for it is - it does not require any migration. With Seraphis we were going to do new addresses, and unfortunately, that was also going to invalidate old addresses. Under the Full-chain Membership Proofs++ proposal, we keep all of our existing addresses. And I believe they gain almost all of the functionality that we'll be discussing today, despite being old addresses that have been around for years.

Right, so features. For Full-chain Membership Proofs++ specifically it actually unifies all of our privacy pools. Right now we have a few different privacy pools on Monero. Most of you probably have never noticed or cared, because we have the original CryptoNote outputs, which reveal the amount and don't have amount privacy in each of those to find their own privacy pool. And then we also have the modern Monero outputs, which do hide the amounts, and that's its own privacy pool. So under this proposal, we finally unify all of them, and we just have one privacy pool for every single output on the Monero blockchain.

It maintains support for hardware wallets. I wrote it in as eligibility, because yes, someone does actually have to go in and update each of our hardware wallets to this new software. But hardware wallets are still going to work. We're not going to say: "Oh no, sorry, you need an i7 with eight cores to make a transaction." Thankfully, we avoid that.

It also allows transaction chaining and with it some L2 designs. This is one of the features that we were looking forward to with Seraphis - the ability to sign a transaction which spends outputs not yet on the blockchain. So that may matter if it's like: oh yeah, I want to, I'm here with my friend Jeff, and we want to buy a house together. We're gonna make this really cool Monero house to do all of our development there, hell yeah. But I don't just wanna send forward half the money for a house, house is expensive. So I can say: oh yeah, I'm going to put the money in for a house, but only if you first make this transaction. And I can make my transaction a dependency of their transaction. So transaction chaining, ignoring my bad example, just allows you to specify requirements for your transaction to actually go live and that enables some protocols.

It also achieves forward secrecy on newly created output. We're still discussing exactly what that definition of new is. It may make it in with the initially proposed Full-chain Membership Proofs++ upgrade, or it may be done a bit after, depending on how the development timeline is. But forward secrecy is another feature. Forward secrecy means that when quantum computers come around, right now, they can trace the entire Monero network with regards to what outputs are spent. But with forward secrecy, quantum computer cannot determine what outputs were spent in a specific transaction. So it's ensuring that even in the future we maintain our privacy.

It also enables, this is the final feature I'm going over, outgoing view keys. So what this is â€”right now if you have a view-only wallet you can see all the times you receive money, you can't see if you've already spent your outputs. So you can't actually calculate the balance. You can only calculate the amount received. With outgoing view keys, you actually can see when an output was spent. And because you can see when an output was spent, you can accurately count your balance. And that greatly improves auditability for things such as charities, public wallets, the general fund and other organizations.

So obviously, with any protocol upgrade, there's going to be a lot of work done. I kind of broke it up into two slides, just going over how the research is going and how the development is going. With regards to the research, we actually have a 20-plus page document detailing all of the actual work being done for the proof itself and how that would be integrated into Monero, so on and so on. And includes, quote, a specification of the circuit. The prior talk briefly mentioned circuits, but didn't really get into it. A circuit is basically a program. So in this case we have a program that says: my output is one of the outputs on the Monero blockchain. And what we do is we create a zero-knowledge proof that that program was executed successfully. So we say that yes, we are proving this output is one of the outputs on the blockchain, but we're not revealing which. So the exact program, the exact circuit that's been specified.

Generalized Bulletproofs, the aforementioned generalization of Bulletproofs we're using that has had security proofs put forward. Technically, it's not generalized Bulletproofs that was proven. The original document missed out on some functionality and what we ended up proving incorporated that functionality, so it actually ended up better than expected. And it also ended up as generalized Bulletproofs. So if you want to be specific and great at naming things, go with that beyond the membership proof that says: this output is one of the outputs on the blockchain, we then have to say: yes, I own this output, I want to spend it in this transaction, this is the key image for it, this is a valid key image. So that's what spend authorization and linkability refers to. And for that, we're actually using existing proofs. We're not doing anything novel. So we're not really pushing any assumptions. We're actually using Bulletproofs++ which are currently used in Monero, and we're also using generalized Schnorr protocols, which are a 2007 work - generalizing Schnorr signatures. A lot of generalizations today.

And then for further aspects, we're actively working with researchers. One of the things we're using is elliptic curve divisors for efficiency. That was actually something posited by Liam Egan, who just spoke. So we're actively working with researchers to forth more review and proofs around that.

And for all of this we did successfully raise the fund at the time. I believe it was $220,000 with Monero's recent price increases I believe it's a bit more and that's to cover all of the necessary security proofs formal verification and audit.

With regards to the development side of things, generalized Bulletproofs, the proof we're using, the underlying zero-knowledge proof, that's been implemented. The circuit itself has been implemented. The Bulletproofs++ and generalized Schnorr protocol work, that's largely been implemented. And all in all, we're targeting a complete set of libraries within the next four months with everything moving to auditing. And then we're targeting a pull request for the actual integration within a few months later. And then my hope would be that activates on mainnet roughly six months after that process. So you make the PR that takes a few months to get reviewed, a few months for everyone to download the new node updates and then finally gets activated. And what ends up being one year and three months from now would be my personal hope.

With regards to performance, as I've said at the start, that was one of the big issues and why a lot of projects use a trusted setup. Trusted setup just lets them achieve greater performance and get something viable. At the last MoneroKon, we were discussing 100 milliseconds in a batch of 10 for 777 million outputs. That has significantly changed. It is now 12 milliseconds, roughly eight times faster, for 2.19 billion outputs, roughly a three times larger set. Further improvements are still expected. Right now we're using generalized arithmetic libraries to implement everything. But if we implement tailored arithmetic libraries, that should just be a nice flat cost benefit to us.

And then one of the things I wanted to note is that performance isn't just about the zero knowledge proofs. Right now with Monero, every time we verify a ring signature, we have to do a lot of random database reads, because for every output that might be being spent, we have to pull up the information on it. One of the benefits of Full-chain Membership Proofs is we just need to keep a 32 byte hash in memory for each block. And that's all we need in order to verify the proof. So not only is the proof a lot smaller, sorry, the proof is a lot larger, but not only has the proof been shrunk a lot from where it was, it also avoids the database reads we currently face. So comparatively, it will also, comparatively it also has that benefit. Though yes, these are still more expensive than our current ring signatures.

For next steps, it's just really heading down the same path we're currently on. It's about the development, maintaining contact with researchers and auditors. We reached out to a bunch for a recent tasks. We'll be reaching out to them again for future tasks, really just maintaining those relationships. Then it's also about getting more developers in the Monero project familiar. It's been discussed a lot and I do feel like most Monero developers have reasonable awareness of it. But when the time actually comes to review the PRs and finish off the integration, I'm pretty sure everyone's going to start commenting and trying to include their own words on the matter. So just about getting developers familiar now so we don't have those delays later.

Any questions?
