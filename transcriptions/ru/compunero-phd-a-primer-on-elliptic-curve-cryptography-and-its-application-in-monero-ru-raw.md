# Compunero, PhD

_**Введение в криптографию на эллиптических кривых и её применение в Monero**_

_Этот доклад представляет собой введение в криптографию на эллиптических кривых (ECC). Подразумевается, что слушатели будут иметь как минимум базовое, или, что намного лучше, среднее представление об этой области криптографии._

_Для начала мы рассмотрим основные принципы асимметричной криптографии. Затем мы обсудим применение кривых в ECC и текущую безопасность, также мы сравним асимметричную криптографию без ECC с ECC. И наконец, мы поговорим о математических принципах ECC, включая фундаментальные математические операции, и о том, как эллиптические кривые применяются в криптографических механизмах Monero._

_Электронная почта для вопросов: compunerophd@proton.me_

[https://youtu.be/ZG0ZJCwRKfs](https://youtu.be/ZG0ZJCwRKfs)

---

_**Модератор:**_

Джей работал как в технологических компаниях, так и в академических учреждениях. В конце концов, сфокусировался на безопасности облачных технологий, машинном обучении, поведенческой аналитике, а теперь работает в области управлением приватными облаками. В этом выступлении он расскажет о базовых принципах асимметричной криптографии и о том, как эллиптические кривые применяются в криптографических механизмах Monero. Джей, можешь начинать.

_**Джей:**_

Спасибо.

Спасибо всем, кто пришёл. В ближайшие 20 минут или около того мы просто поговорим о некоторых концепциях построения эллиптических кривых и о том, как они используются при создании адресов Monero. Моё выступление не предполагает углубления в математические дебри. Я просто опишу некоторые концепции и постараюсь помочь разобраться в них, независимо от того, имеете ли вы богатый опыт работы с эллиптическими кривыми или же впервые слышите о них.

Итак, эллиптические кривые. Это общая формула для построения эллиптических кривых. Эллиптические кривые - это какая-то одна кривая. Это целое семейство кривых. И как вы видите, эти два параметра, a и b, имеют определённые значения, которые задают форму кривой и, следовательно, свойства этой кривой.

Вот несколько примеров таких кривых. Слева приводятся параметры a и b, имеющие разные значения, и они определяют, как будет выглядеть кривая. Напомню: под эллиптической кривой мы подразумеваем не просто одну кривую, а целое семейство кривых. Люди могут брать определённые значения a и b, а затем определять, изучать и доказывать конкретные случаи использования получаемых кривых.

Есть ещё одно понятие, называемое "полем". Поле - это, по сути, комбинация значений a и b или допустимых значений a и b. Таким образом, это ещё одно понятие, используемое применительно к кривым.

Теперь поговорим о нескольких операциях. Они очень важны в контексте эллиптических кривых. Одна из них известна как "операция сложения", а другая как "операция удвоения" или "операция умножения". Технически умножение - это некая последовательность операций сложения. Когда мы умножаем 5 на 2, это означает, что мы прибавляем 5 к 5. Такова базовая концепция. Поэтому, когда мы говорим об умножении, технически речь идёт о сложении, поскольку умножение a означает сложение a плюс a. Так что всё укладывается в рамки понятия сложения. На следующих слайдах мы рассмотрим концепцию сложения и попытаемся понять, как она применяется при построении эллиптической кривой.

Итак, прежде всего, когда у нас есть одна единственная точка на кривой, допустим, точка g, это случайная точка. И у нас есть кривая с определёнными параметрами a и b. Это эллиптическая кривая, точнее, один из примеров эллиптической кривой. Теперь, если вы захотите взять значение g и добавить к нему ещё одно значение g, то есть вычислить 2g на основе этого значения g, то, по сути, вам будет нужно сложить g + g или удвоить g, чтобы получить 2g.

Итак, шаги при работе с эллиптической кривой будут следующими: берётся касательная, являющаяся прямой линией и касающаяся этой точки. Эта касательная гарантированно пересечёт эллиптическую кривую только в одной другой точке. Она пересечётся с ней в этой точке, и в качестве второго шага мы проецируем эту точку на другой стороне x и получаем 2g. Таким образом, операция сложения на эллиптической кривой в общем случае выполняется так: берётся точка, берётся касательная к этой точке, а затем берётся её проекция на оси x, над x, и в результате мы получаем точку 2g.

Рассмотрим другой пример. Теперь у нас есть уже не одна, а две точки, g и 2g, и на их основе мы хотим получить точку 3g. Процесс построения эллиптических кривых сводится к тому, что берётся единственно возможная прямая линия между точками g и 2g, и эта линия гарантированно пересекает эллиптическую кривую только в одном месте, в одной точке. И вот что получается: пересечение происходит в этой точке, мы берём её проекцию по оси x и получаем 3g.

Ещё один пример - как получить число 4g. Итак, у нас есть первая точка g и точка 3g. Мы хотим получить 4, то есть сложить 1 + 3. Весь процесс сводится к тому, что вы просто проводите линию между точками 1 и 3, а затем находите точку пересечения, которая гарантированно будет единственной. Затем вы проецируете эту точку на оси x, и в результате получаете 4g. Таким образом, все эти четыре точки, по сути, происходят из одной единственной начальной точки, которую в данном случае мы обозначили как g.

Как видите, при сложении сначала выбирается одна точка на кривой, после чего затем вы добавляете эту точку к себе самой столько раз, сколько пожелаете. И технически вы всегда находитесь на этой кривой. То есть технически вы двигаетесь так, как если бы вы двигались по этой кривой случайным образом. В этом и заключается идея.

Следующий шаг в этой операции сложения заключается в том, что сложение - это не просто, как если бы я, скажем, чтобы получить 10g, каждый раз прибавлял по 1g. Это потребовало бы совершения девяти операций. Я сделал бы это немного умнее. Я бы взял g и g, что дало бы мне 2g. А затем я бы взял 2g и 2g, что дало бы мне уже 4g. Потому что в этом случае операция умножения затратна ровно настолько, насколько затратна одна операция сложения. И поэтому за четыре шага я могу получить 10g. И это ещё одна особенность эллиптических кривых. Поскольку в базовой математике ng + rg, не обязательно одно и то же число, всегда будет просто равносильно математике, (n + r)g. Даже если это не так. Технически, вы добавляете g как абсолютное число к другому g. Это метод сложения эллиптической кривой.

Итак, как уже было сказано, эллиптические кривые - это гигантская область криптографии. В литературе описано множество различных способов их построения. И в случае Monero для генерации адресов используется одна конкретная кривая, входящая в семейство кривых Эдварда. Существует семейство кривых под названием "Кривые Эдвардса", в котором есть так называемые "скрученные кривые Эдвардса", и одна из них используется в Monero. Остановимся на ней отдельно.

Это конкретная кривая. В соответствии с первым рассмотренным нами уравнением она относится к эллиптическим кривым. У неё есть определённые параметры a и b и набор дополнительных параметров или значений, которые задаются специально для этой кривой. Поле, соответствующее конкретно этой кривой, называемой Ed25519, определяется этими значениями, 2255 – 19. Если вы забудете название, то увидите, что оно основано на определении поля. 19 - это простое число, ну и значение 2255 - отсюда и название.

Теперь перейдём к асимметричной криптографии, к которой мы в конечном счёте прибегаем в процессе реализации концепции построения адресов Monero. Для справки: асимметричная криптография, само слово "ассиметричная", используется, поскольку у нас имеется два разных ключа - один, предназначенный для шифрования, и другой, необходимый для дешифровки. И, как правило, в работах по криптографии используются имена Боб и Элис, пользователей, которые как бы обмениваются какими-то данными. При этом вся концепция асимметричной криптографии заключается в создании общего секрета или попытках передать его по небезопасному каналу. То есть канал, по которому они обмениваются информацией, никак не защищён. И для такого обмена создаётся некий защищённый протокол - в этом состоит основная идея. Протокол предполагает, что всегда есть открытый ключ и есть закрытый ключ. И если Боб хочет отправить сообщение Элис, у Элис всегда будет закрытый ключ и соответствующий открытый ключ, полученный на основе этого закрытого ключа, которым она делится публично. А Боб в свою очередь использует её открытый ключ, чтобы зашифровать сообщение. Затем они передают зашифрованное сообщение по незащищённому каналу, а после расшифровывают его с помощью определённого алгоритма и этого закрытого ключа. Такова основная концепция асимметричной криптографии.

Теперь, в контексте эллиптических кривых и с учётом концепции асимметричной криптографии, у Элис будет некое начальное значение. Обозначим его как G. Это значение является общим - Элис, Бобу и вообще всем в мире известно это значение. У Элис есть закрытый ключ, но это число известно только Элис. Это просто целое число, число определённой длины, в зависимости от кривой или приложения, которое мы используем. А открытый ключ - это параметр b, умноженный на начальное значение G. В случае с эллиптической кривой, когда мы говорим о b, умноженном на G, это означает, что вы прибавляете значение G к самому себе b раз. Таким образом, в терминах эллиптической кривой - это умножение, то есть просто G плюс G плюс G b раз. И та же самая концепция используется Бобом. У него тоже есть G, то же самое - собственный закрытый ключ. Он не делится им, но он делится открытым ключом, который технически просто прибавляет G к самому себе, к числу закрытого ключа, который имеется у Боба.

И так вычисляется окончательный ключ, который используется для расшифровки. Это немного отличается от той концепции, о которой мы говорили ранее - здесь используется вычисленное значение, и это вычисленное значение представляет собой комбинацию, то есть a умноженное на b и умноженное на G. То есть a от Боба - ему известно это значение. А b, умноженное на G, уже используется Элис, поскольку это открытый ключ. Так что теперь Боб может сгенерировать abG. Элис, с другой стороны, тоже может сгенерировать точно такое же значение, потому что у неё есть b, а также a, умноженное на G, и в итоге тоже получится abG. И только Элис и Боб могут сгенерировать abG, поскольку обладают собственным закрытым ключом.

И теперь я хотел бы коснуться традиционных методов, не использующих эллиптические кривые, таких как метод Диффи-Хеллмана, который является известным алгоритмом RSA, и прочих. Я хотел бы сделать это параллельно с методами, использующими эллиптические кривые, своего рода концепциями высокого уровня, чтобы вы смогли увидеть различия.

Итак, у нас есть некоторое обще для двух алгоритмов начальное значение G. Закрытое значение, то есть некоторое значение, закрытое для Боба и закрытое для Элис, то же самое на эллиптической кривой, a и b. Открытый ключ обычно генерируется путём возведения в степень. То есть речь идёт о некотором значении, равном степени закрытого ключа. То же касается открытого ключа Элис: он получает значение G в степени b. И всё сводится к концепции, согласно которой G в степени ab - это то же значение, что и G в степени ba. Это базовая математическая концепция, и в нашем случае, если, скажем, у Боба есть G в степени b, и теперь ему нужно получить G в степени a, именно эта концепция позволяет вычислить одно и то же значение.

В случае с эллиптической кривой вычисляется ab, умноженное на G. И теперь, если вы заметили, в первом случае мы имеем возведение в степень, а здесь - простое умножение, в результате которого, по сути, G добавляется требуемое количество раз. И в данном случае мы получаем гораздо более короткий ключ. В некоторых случаях на порядок. Например, четырёхзначное число или, скажем, в случае десятичными числами, скажем, 2800 против 200. То есть, методы с использованием кривых позволяют, например, более короткий ключ с тем же уровнем сложности и тем же уровнем безопасности.

Теперь немного о минусах эллиптических кривых. Многие из них запатентованы. Как уже было сказано, исследователи присваивают эллиптическим кривым определённые параметры, а затем патентуют их. За прошедшие годы были запатентованы многие из них.

В отличие от RSA, кривые не работают без достаточного уровня случайности. Поэтому при генерации закрытого ключа, если вы не сгенерируете его с использованием истинной случайности, всё может закончиться неудачей. Таким образом, существует большая зависимость от случайности используемого алгоритма генерации ключей.

Некоторые из этих кривых, описанных в соответствующей литературе, могут вызывать подозрения или оказаться скомпрометированными, иметь лазейки. И вот одна из таких кривых, в которой была обнаружена лазейка. Кривая была предложена в 2006 году, а затем 2014 году отозвана. Так что это ещё один из недостатков, связанных с использованием эллиптических кривых.

И, конечно же, их теоретическая основа довольно сложна в сравнении с традиционными методами.

Итак, до этого момента мы не говорили о каком-то конкретном алгоритме. То есть мы не обсуждали определённые алгоритмы генерирации ключей и так далее. Это гораздо сложнее, и предполагает более глубокое погружение в математику. Но сегодня мы говорим не об этом. Тем не менее я опишу концепции, объясняющие суть некоторых идей, одна из которых - операции с модулем. Просто хочу убедиться, что мы не упустили этого. Просто эта операция используется уже повсеместно. И всякий раз, когда речь заходит о криптографии, мы сталкиваемся с операциями с модулем.

Я хотел убедиться, что это всем понятно. Например, в этой формуле, где 2 в степени n равно 16, всё довольно просто, верно? Вы сразу скажите, что n равно четырём. Но если добавить модуль, вы уже не можете сказать, чему равно n, так ведь? Потому что в такой операции при той же самой основе в степени n, это может быть 16, потому что модуль равен 16. Ответ будет 16, и тогда n будет равно 4. Но затем всё зацикливается. Так что при 16, 17 вы получите 33. А каким будет n, если 2 в степени n будет равно 33? Вы попытаетесь вычислить, а потом всё зациклится. Так что это не детерминированный ответ. Поэтому я и хочу убедиться в том, что это понятно каждому из вас. Ведь именно для этого в данном случае используется модуль.

В завершении в качестве примера возьмём конкретный случай создания адресов Monero. Итак, это конкретная кривая, скрученная кривая Эдвардса 25519. Именно эта кривая используется для генерации адресов Monero. Это поле, а это общее количество точек. 2255 минус 19. Общее количество точек, которое можно выбрать для нашего закрытого и открытого ключей. И это наш закрытый ключ, а это, соответственно, открытый ключ, поскольку технически открытый ключ - это закрытый ключ, умноженный на определённое число, на G. А G - это фиксированное число. Я привёл его здесь, чтобы вы поняли, что значение G не скрыто - оно известно и открыто. Это определённое число. А ещё есть дополнительное число l, являющееся простым числом, и это конкретное число находится непосредственно здесь. И это значение мы используем в операции с модулем, о которой мы только что говорили. Таким образом, на протяжении всего процесса на нескольких этапах используется модуль и число l, к которому относится модуль, это значение, по которому производится операция с модулем. Так что технически генерируемые вами закрытые ключи будут находиться в диапазоне от 0 до этого значения минус 1, потому что это значение всегда будет больше.

Безусловно, проблема создания адресов Monero, гораздо сложнее, чем я её описываю. Есть три типа адресов: стандартные адреса, подадреса и интегрированные адреса. Мы берём только стандартный адрес, который также известен как "сырой адрес".

Сырой адрес состоит из четырёх частей. Первая - это публичный ключ траты. Вторая - публичный ключ просмотра. Далее следуют сетевой байт и контрольная сумма. Мы остановимся только на первых двух. Но всё же поговорим обо всех них в целом.

Итак, размер адреса Monero составляет 69 байт, и он состоит из конкретных частей. Первый байт зарезервирован под так называемый тип сети, и это переопределяемые значения. 32 байта используются для публичного ключа траты и ещё 32 байта - для публичного ключа просмотра. Затем этим следует контрольная сумма, занимающая 4 байта, сгенерированные из этих 65 байт с помощью некоторой функции хеширования. Затем эти 69 байт обрабатываются с помощью алгоритма, известного как Base58, в результате чего получаются 95 символов, которые, по сути, и являются сырым адресом. Здесь показан пример такого адреса, который, я уверен, видел хоть раз.

Что касается типа сети - здесь у нас имеется два основных значения. Первое - 18, то есть 12 в шестнадцатеричном формате, а 53 - это для тестовой сети. Либо основной, либо тестовой. В любом случае можно сгенерировать что-то ещё. Но это две основные вещи, которые известны для первого байта.

И теперь та часть, которую необходимо присоединить. Опять же, мы не говорим о каких-то конкретных алгоритмах. Мы говорим в целом. В идеале мы создаём два закрытых ключа, обозначим их как a и b. Один из них будет использоваться для создания открытого ключа траты, который технически является a, умноженным на G, применительно к эллиптической кривой, а открытый ключ просмотра - b, умноженным на G. И в середине этой операции мы всегда должны ограничиваться значением l, которое также переопределяется операцией с модулем.

В реальности мы не генерируем два отдельных закрытых ключа. Мы генерируем один, чтобы создать открытый ключ. Затем с его помощью мы производим хеширование, чтобы создать другой закрытый ключ, и на его основе создаём открытый ключ просмотра для имеющегося адреса. Адрес записывается символами, но это, опять же, не какой-то определённый алгоритм, тем не менее, адрес, в конечном счёте, это просто некое объединение всех этих значений. А затем применяется алгоритм Base58, который, по сути, просто выбирает 58 символов, и все буквы кодируются с помощью этих 58 символов. Обычно мы используем 64 символа, но в данном случае используется 58. Я выделил те, которые исключены: ноль, I, O и маленькая l. Причина заключается в том, что эти символы можно спутать. Так, I обычно путают с маленькой l, а ноль и O обычно путают друг с другом. Поэтому они удалены. И здесь в дело вступает Base58, ставший довольно популярным именно по этой причине.

И последняя часть, контрольная сумма, занимает всего 65 байт, а затем генерирует определённый хеш, первые четыре байта контрольной суммы.

Вот, собственно, и всё. Здесь указаны некоторые ресурсы по теме. И я надеюсь, что своим выступлением помог разораться в том, как создаётся адрес Monero.

Спасибо за внимание. А теперь вы можете задать вопросы
