# Майк (Stringhandler)

_**Обеспечение различных уровней конфиденциальности в Tari**_

_Tari позволяет разработчикам смарт-контрактов выбирать уровень применяемой конфиденциальности для каждого случая использования, начиная от полного отсутствия конфиденциальности и заканчивая наивысшем уровнем. В этом докладе мы рассмотрим каждый из уровней и их компромиссы._

[https://youtu.be/SPNOCW8bM-o](https://youtu.be/SPNOCW8bM-o)

---

_**Майк:**_ Меня зовут Майк, в Twitter и на GitHub, если вы захотите найти меня там, я известен как Майк Стрингхэндлер, и я являюсь ведущим мейнтейнером Tari.

Итак, че мы сегодня займёмся: мы сравним различные уровни конфиденциальности блокчейнов и рассмотрим несколько примеров контрактов, используемых в Tari. Уверен, что никто из вас их ещё не видел. В 12:40, то есть сразу после обеда, в секции Института криптоанархии, что находится над входом, мы будем проводить семинар, где подробно разберём эти примеры, чтобы продемонстрировать, как создаются контракты Tari. Сразу отмечу, что не стану углубляться в технические аспекты, связанные с доказательствами SNARK. Да, буквально только что закончилось выступление, посвящённое использованию SNARK. В случае с доказательствами SNARK приходится строить соответствующие схемы, и это также возможно в Tari, но это не делается по умолчанию. И сейчас мы об этом поговорим.

Итак, мы стремимся построить все эти вещи - здесь много говорилось о том, как мы собираемся строить будущее. И я попытаюсь помочь выбрать тот уровень конфиденциальности, который подходит для достижения наших целей. Итак, как это делается в случае с Tari?

Для начала разберёмся, что такое Tari. Это двухуровневый блокчейн. Первый уровень реализует доказательство работы на базе протокола Mimblewimble. Второй уровень обеспечивает высокую пропускную способность. На нём производится сегментация данных с помощью Cerberus. К сожалению, я не могу вдаваться в подробности, поэтому продолжим.

Почему именно Tari? Как уже было сказано, первый уровень использует доказательство работы, обеспечивая безопасность не требующих авторизации и каких-либо разрешений денежных операций. Второй уровень обеспечивает высокую пропускную способность и использует механизм быстрого завершения - Fast Finality. Мы можем увеличить размер блока на первом уровне, о чём говорил ArcticMine, но тогда мы лишимся возможности быстрого завершения. То есть нам по-прежнему около двух минут будем ждать прохождения очередного блока. Но на втором уровне Tari целью является время завершения в 10 секунд для всей сети.

Итак, речь идёт о сегментации данных, а не контрактов. Вы сможете взаимодействовать со множеством различных контрактов, используемых децентрализованными биржами, менеджерами AAM и так далее. Мы уделяем большое внимание удобству разработки. Поэтому мы создали объектную модель, позволяющую легко спроектировать и построить всё, что вы захотите. И у нас очень низкий барьер для создания конфиденциальных активов и транзакций.

Продолжим. Когда появится Tari? Это главный вопрос, верно? Вероятно, вы видели, что на наших футболках написано, что первый уровень будет в реализован в основной сети в 2024 году, то есть, уже в течение этого года. А для второго уровня уже запущена тестовая сеть для разработчиков, и если у вас есть смарт-контракт, вы можете опробовать его в этой сети.

Как работает Tari? Довольно мелкий слайд, прошу прощения. Это пробный пример - Hello World! Вот так будет выглядеть контракт Tari. Он написан на языке Rust, компилируется в WASM и выполняется на виртуальной машине, виртуальной машине WASM. Все узлы выполняют код и согласуют результат. И если все согласны с ним, результат отправляется в блокчейн. Данный пробный пример можно рассмотреть более подробно, но в целом это выглядит вот так. А в случае с новыми методами вы просто будете создавать новый компонент и добавлять его сюда.

Итак, прежде чем мы перейдём к рассмотрению различных уровней, я хочу вернуться на шаг назад и разобраться с тем, что требуется в случае работы с деньгами? Какие проверки необходимы, если мы собираемся совершить с кем-то обмен. И вот две из них, которые всегда приходят на ум первыми: настоящие ли деньги, которые я получаю, и не были ли они уже потрачены? И если у вы задумали создать что-то в блокчейне, то необходимо проверить: должно ли это быть в блокчейне или в каком-то другом приложении? И так, реальны ли деньги? Важно, кому вы хотите это доказать? Если вы хотите доказать это только самому себе, то достаточно просто поверить. Но когда два человека взаимодействуют друг с другом, первое, что вы делаете, - проверяете реальность денег.

И вот пример. Это объявление о продаже игрового руля, размещённое на Facebook. Руль продаётся за 5000 южноафриканских рэндов. Если вы захотите купить это, станем проверять именно эти две вещи. Итак, реальны ли деньги? Продавец, получив от кого-то наличные деньги, если он получил их в реальности, первым делом посмотрит, настоящие ли они: не напечатаны ли они на принтере или подделаны каким-то другим образом? Если это банк, то мы доверяем ему, и достаточно, чтобы нам просто сказали, что деньги настоящие. Со стороны покупателя всё очень просто: действительно ли у продавца есть этот товар? Но есть и второй вопрос: не был ли актив уже потрачен? Что касается наличных денег и банковских операций, то здесь всё понятно и настолько привычно, что мы даже этого не проверяем. Если это наличные, мы знаем, что они есть, мы видим, что деньги на месте. Если это банк, то банк говорит нам, что деньги не были потрачены. Если речь идёт о реальной вещи, то при личной встрече вы можете увидеть, что у продавца есть руль. Но всё происходит онлайн, то очень велика вероятность, что руль уже был продан кому-то другому. И это те две проверки, которые необходимо учитывать при разработке протокола обмена деньгами. И это легко реализуемо.

Это стало прорывом, когда появился Bitcoin. Как известно, когда Сатоши создал Bitcoin, мы отказались от идеи доверия какому-то центральному органу и смогли проводить оплату в электронном виде. То есть уже не нужно было иметь при себе физические деньги. Именно так родилась идея исключения третьей стороны из цепочки. Теперь две стороны сами могут проверить, является ли что-то реальным или нет. А разработанная Сатоши модель UTXO в свою очередь исключала возможность двойной траты выходов, которые считаются неизрасходованными. Недостатком этой модели была прозрачность сумм - вся история транзакций фиксировалась в реестре, и все могли с ней ознакомиться.

Сатоши принял это к сведению, и вот цитата из "Белой книги". Итак: "Традиционная банковская модель обеспечивает определённый уровень конфиденциальности, ограничивая доступ к информации вовлечёнными сторонами и доверенной третьей стороной. Необходимость публично объявлять обо всех транзакциях исключает этот метод". То есть он указал на тот факт, что предложенная им модель менее конфиденциальна, чем традиционная банковская. Поэтому мы рассмотрим некоторые уровни, и ещё вернёмся к этой цитате в конце презентации.

Вот уровни конфиденциальности, начиная с Bitcoin. Если спуститься ниже, то на третьем уровне мы найдём Monero. Но я собираюсь пройтись по всем ним, так что и до Monero мы доберёмся в своё время.

Итак, нулевой уровень - это Bitcoin и Ethereum, как известно, это не конфиденциальные активы. Допустим, нам нужно проверить, реальны ли они? Проверка сводится к тому, чтобы узнать, существует ли они где-то в блокчейне? То есть я получаю какие-то средства, какие-то UTXO, но существуют ли они на самом деле? А затем мы проверяем, не были ли они потрачены ранее. Bitcoin для использует модель UTXO, а Ethereum - счета и нонсы. Таким образом, существует два разных подхода. Ethereum использует так называемую "модель счетов", которую мы сейчас увидим.

Итак, нулевой уровень в Tari. Прошу прощения за то, что здесь я воспользовался документацией, но это очень просто. Мы реализовали несколько различных ресурсов, которые вы можете создать. И если вы захотите создать ресурс, который будет валютой или невзаимозаменяемой валютой, вы можете выбрать один и з вариантов: "взаимозаменяемая", "невзаимозаменяемая" или "конфиденциальная" в зависимости от вашего случая. Так мы можем создать взаимозаменяемые токены для первоначального предложения. Не забывайте, что это нулевой уровень. Итак, мы вызываем ResourceBuilder, создаём взаимозаменяемый токен и публикуем его. Если вас интересуют подробности, это будет обсуждаться на семинаре в обед.

Итак, всё совершенно прозрачно. И теперь перейдём на следующий уровень. Следующим уровнем будет сокрытие сумм.

Сначала мы проверяли, является ли актив реальным и не был ли он уже потрачен. Тут то же самое. Но в данном случае мы используем так называемое обязательство Педерсена. Это немного более техническая процедура, но, по сути, в качестве закрытого ключа берётся сумма. Мы берём новый закрытый ключ, который будет маской, и объединяем их в открытый ключ. Теперь, поскольку мы скрываем суммы, мы должны убедиться, что не получаем отрицательной суммы, и что используется доказательство диапазона. Как правило, именно здесь размер транзакций начинает увеличиваться. И во многих случаях, в Monero и Tari, мы используем доказательства Bulletproofs.

Это API для создания конфиденциальной монеты. Как можно увидеть, всё очень похоже, но мы просто вызываем ResourceBuild : : confidential. И вместо суммы нам нужно получить вывод информации. И вот ещё немного подробностей: сумма была заменена на обязательство. Также здесь присутствуют некоторые зашифрованные данные для справки, а также для того, чтобы отправитель мог узнать, какова сумма, или любые детали, необходимые для её расшифровки.

Так что, к сожалению, это конец пути для модели счетов. А Ethereum полностью основан на этой модели. В Tari встроена модель счета, которую мы абстрагировали поверх модели UTXO, потому что второй уровень Tari полностью построен на базе модели UTXO. И мы абстрагировали модель счета. Но если вы захотите пойти дальше, вам придётся начать использовать UTXO на втором уровне.

А это моё, если угодно, спорное мнение. Как только вы начнёте использовать UTXO, вам придётся сканировать весь блокчейн. На мой взгляд, отсутствие индексов в случае с лёгкими кошельками при этом является большим препятствием с точки зрения регулирования, вернее, препятствие для технологий повышения приватности, а не самого регулирования. Я хочу сказать, что у MetaMask 30 миллионов активных пользователей, в то время как только 18 000 пользователей поддерживает узлы Bitcoin. И если вы попытаетесь создать криптовалюту, повышающую уровень приватности, то всем придётся запустить полный узел, а это значит, придётся сканировать весь блокчейн. И это проблема. Так что если вы ищете область, где можно добиться большего внедрения, на мой взгляд, на эту проблему стоит обратить внимание.

Итак, продолжим. Суммы скрыты, но граф транзакций по-прежнему открыт. Теперь рассмотрим второй уровень, где мы скрываем отправителя и получателя. Это идея использования одноразовых адресов, предложенная Сатоши. Mimblewimble и первый уровень Tari также построены подобным образом. Это то же самое, поскольку мы просто ищем входы и выходы, которые тратятся. Сначала нам просто нужно выяснить, существуют ли выходы в блокчейне, а затем мы проверяем, были они потрачены или нет, чтобы убедиться в отсутствии двойной траты. Всё это требует какого-то взаимодействия вне блокчейна, и поэтому мы не можем отразить многого в контракте Tari, ведь всё это, по сути, делается вне блокчейна. Вы можете сделать это, но вам всё равно придётся взаимодействовать таким образом.

И сейчас мы приближаемся к уровню, на котором находится Monero вместе со своими ложными входами и кольцевыми подписями.

На этом уровне вместо того, чтобы помечать вход как потраченный и создавать новые выходы, мы выбираем несколько ложных выходов. Так, в качестве ложных Monero использует 11 входов. В случае с Lelantus их гораздо больше.

Одна из проблем заключается в том, что при малом размере ложных выходов приходится быть осторожными в их выборе. Именно по этой причине в Monero нельзя использовать временную блокировку, именно по этой причине нельзя использовать определённые смарт-контракты, как говорил Люк. Приходится быть осторожными. Если включить какие-либо идентификаторы в небольшой набор входов, их можно будет запросто исключить при анализе. Думаю, по той же причине не разрешается их тратить ранее, чем по добавлении 10 блоков.

А при наличии гораздо большего набора, очевидно, вы не сможете отсеять такое количество, поэтому Lelantus не приходится особо беспокоиться о том, чтобы все выходы выглядели одинаково.

Но теперь в дело вступает наша проверка. Как нам определить, настоящие деньги мы получаем или нет. В данном случае нам нужно просто убедиться, что все входы существуют, верно? Но нам нужно какое-то доказательство по одному из многих. Итак, у нас есть набор, состоящий из  множества выходов, из которых мы можем выбирать, и мы можем либо использовать кольцевую подпись, либо использовать доказательство по одному из многих.

Поэтому, когда я впервые записал это как смарт-контракт Tari, я использовал доказательство Йенса Грота по одному из многих и построил его именно таким образом. Но затем я перешёл ко второму критерию: как выяснить, были ли потрачены выходы или нет? Итак, проблема двойной траты. Вы не можете пометить ни один из ваших входов как потраченный, когда создаёте анонимный набор, потому что тогда это автоматически позволит исключить их. Поэтому все входы должны оставаться непотраченными. Проблема решается с помощью уникального связующего тега. В Monero он называется "образом ключа". И когда вы создаёте транзакцию, если этот выход будет потрачен, генерируется уникальный тег. И вот что мы собираемся сделать - в Monero для этого используется CLSAG. В Lelantus реализована одна очень умная вещь с раскрытием количества. Я перенёс это в Tari, и если вы хотите создать что-то подобное, вы также сможете сделать это. Вы можете использовать другую кольцевую подпись, но я использую стратегию Triptych, а затем, чтобы сохранить связующий тег, нам нужно сделать это в каком-то уникальном месте. Для этого я использовал адрес субстрата Cerberus в Tari.

И вот как это будет выглядеть. Знаю, всем это интересно, и всё выглядит вот так. По сути, просто создаётся оператор Triptych с набором входов, и всё проверяется. Теперь это же компилируется из Rust в WASM, а затем запускается на каждом из узлов. В какой-то момент мы можем встроить это в API, но я сделал всё в виде смарт-контракта.

На следующем уровне используется доказательство участия на базе полного блокчейна, полностью исключающего проблему выбора ложных выходов. И протокол Seraphis, разработанный Monero, - хороший пример этого. У меня пока нет примера того, как это можно было бы реализовать в Tari, но если вам будет интересно, то у меня имеется несколько идей, которыми я бы с радостью поделился с вами после.

Итак, давайте поговорим о некоторых вещах, которые в настоящее время недоступны в блокчейне, но теперь доступны на Tari. Вернёмся немного назад. Вот так.

Одна из вещей, которую вы можете сделать, это создать NFT, который позволит вам воспользоваться сервисом Twitch, не раскрывая, какой из NFT принадлежит вам. Это довольно интересно, и если вас тоже интересует подобный  вариант использования, дайте мне знать, и я с радостью расскажу об этом подробней.

И это может показаться спорным, но если вернуться к "Белой книге", где уровень конфиденциальности обеспечивался между двумя сторонами, вовлечёнными в сделку, и доверенной третьей стороной, - мы работаем над чем-то подобным для Tari. Это встроено в API, и при создании конфиденциальной монеты эмитент может предусмотреть наличие ключа просмотра. В этом случае эмитент, стороны, совершающие транзакцию, смогут увидеть сумму, увидеть проводимые транзакции, но никто другой, кроме них, не сможет. То есть, для всех остальных то, с кем вы совершаете сделки и каковы суммы, останется тайной.

Зачем нам использовать что-то подобное? Один из самых распространенных вариантов использования являются конфиденциальные стейблкоины. Допустим, вы хотите платить своим сотрудникам в стейблкоинах, но не хотите, чтобы кто-то узнал, каковы точные суммы. Но вы или некоторые из ваших сотрудников могут не захотеть сталкиваться с жёстким регулированием. И для этого вы сможете использовать конфиденциальные стейблкоины. Монеты, принимаемые биржами, могут также использоваться в некоторых традиционных банковских сценариях, например, в кредитовании под проценты. Это более безопасный вариант для тех, кто только начинает работать с криптовалютами. И, возможно, это решит проблему лёгких кошельков. Существует ли сейчас конфиденциальная монета, с которой работает MetaMask? Так что, полагаю, перед нами открывается целый ряд крутых возможностей.

И главное, я не собираюсь навязывать вам какой-то конкретный уровень конфиденциальности. Как пользователь или как разработчик контракта, вы можете сами выбрать его. Именно поэтому мы применяем именно такой подход, позволяющий делать именно это.

Итак, сегодня в обед, в 12:40, у нас будет семинар, на котором мы рассмотрим некоторые из описанных уровней и то, как создать свой собственный контракт. Также есть ещё один проект, проект Tari под названием Awesome Tari, который может послужить демонстрацией нескольких по-настоящему крутых примеров использования и подсказать отправную точку.

На этом у меня всё.
